<p-progressBar [mode]="things.loading ? 'indeterminate' : 'determinate'" class="loading-bar" />
<riw-global-toast />

<div class="main-wrap">

<div class="button-row">
  <!-- TODO Edit a single selected row, try to leverage existing New Thing dialog? -->
  <p-button (onClick)="things.getAllThings()" icon="pi pi-refresh" [loading]="things.loading" severity="info" />
  <p-button (onClick)="addNew.show()" icon="pi pi-plus-circle" label="New Thing" />
  <p-button (onClick)="manageTemplate.show()" icon="pi pi-list" [label]="'Manage ' + templateService.getTemplateCount() + ' Templates'" />
  <p-button (onClick)="confirmDeleteSelected($event)" icon="pi pi-trash" [label]="getDeleteLabel()" [disabled]="!hasSelectedRows()" />
  <p-confirmPopup />
  <p-progressSpinner *ngIf="things.loading" />
</div>
<riw-add-new-dialog #addNew (manageTemplateEvent)="manageTemplate.show($event)" />
<riw-manage-template-dialog #manageTemplate />

<!-- TODO Add sorting, filtering, etc. -->
<p-table [value]="things.data" styleClass="p-datatable-striped"
         class="thing-table"
         selectionMode="multiple" [(selection)]="selectedRows"
         (sortFunction)="customSort($event)" [customSort]="true"
         sortField="time" [sortOrder]="-1"
         [resizableColumns]="true" columnResizeMode="fit"
         [loading]="things.loading"
         >
  <ng-template pTemplate="header">
    <tr>
      <th pResizableColumn pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
      <th pResizableColumn pSortableColumn="time">Date <p-sortIcon field="time"></p-sortIcon></th>
      <th pResizableColumn pSortableColumn="templateType">Type <p-sortIcon field="templateType"></p-sortIcon></th>
      <th pResizableColumn pSortableColumn="fields">Fields <p-sortIcon field="fields"></p-sortIcon></th>
    </tr>
  </ng-template>
  <!-- TODO Style width of columns as we fill them out -->
  <ng-template pTemplate="body" let-data let-rowIndex="rowIndex">
    <tr [pSelectableRow]="data" [pSelectableRowIndex]="rowIndex">
      <td><span [style]="'color:' + data.color">{{ data.name }}</span></td>
      <td><span [style]="'color:' + data.color">{{ data.time | date: 'MMM dd &rsquo;yy \'at\' h:mm a' }}</span></td>
      <td><span [style]="'color:' + data.color">{{ data.templateType }}</span></td>
      <td>{{ data.getFieldsAsString() }}</td>
    </tr>
  </ng-template>
  <ng-template *ngIf="!things.loading" pTemplate="emptymessage" let-columns>
    <tr>
      <td colspan="4" class="center">
        No data found yet
      </td>
    </tr>
  </ng-template>
</p-table>
</div>